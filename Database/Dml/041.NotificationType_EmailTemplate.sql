
USE [$(dbName)]
Go

If Not Exists(select NotificationTypeId from TblNotificationType where NotificationTypeNameAlias = 'SurveyEmailNotification')
Begin
	insert Into TblNotificationType
		([NotificationTypeName] ,[NotificationTypeNameAlias] ,[Description] ,[DateCreated] ,[DateModified] ,[IsActive] ,[NoOfAttempts] ,[IsServiceEnabled] ,[IsQueuingEnabled] ,[ModifiedByOrgRoleUserId])
	values
		('Survey Email Notification' ,'SurveyEmailNotification' ,'Email Survey to be conducted next day after Event' ,getdate() ,getdate() ,1 ,1 ,0 ,0 ,null)
End
Else
Begin
	Update TblNotificationType
	set [NotificationTypeName] = 'Survey Email Notification'
		,[NotificationTypeNameAlias] = 'SurveyEmailNotification'
		,[DateModified] = getdate()
	where NotificationTypeNameAlias = 'SurveyEmailReminder'
End



delete from TblEmailTemplate where EmailTitle = 'SurveyEmailNotification'

INSERT INTO [TblEmailTemplate]
           ([EmailTitle],[EmailSubject],[EmailBody],[DateCreated],[DateModified])
VALUES
('SurveyEmailNotification','Customer Service Questions' 
	,'<table style="border-collapse: collapse; border-color: black;" border="1" cellpadding="0"     cellspacing="0" width="600">     <tr>         <td style="width: 600px; border: 1px">             <table style="font-family: Arial" border="0" cellpadding="10" cellspacing="0" width="600">                 <tr>                     <td style="height: 143px">                         <table border="0" cellpadding="10" cellspacing="0" width="600">                             <tr>                                 <td style="width: 250px">                                     <img src="@Model.EmailCommunicationBaseInfo.EmailNotificationLogoRelativePath" />                                 </td>                                 <td style="width: 350px" align="right">                                     Customer Service Questions                                 </td>                             </tr>                         </table>                     </td>                 </tr>                 <tr>                     <td>                         Dear <b>@Model.CustomerName.ToString()</b>,                     </td>                 </tr>                 <tr>                     <td style="font-size: 13px; width: 600px">                         Yesterday you made a great stride on the road to better health. @Model.EmailCommunicationBaseInfo.CompanyName                         is committed to providing you the best possible experience on our mobile health                         bus. In order for us to continue to perform above expectations, we ask that you                         complete a short survey. The survey should take no longer than 5 minutes of your                         time. We greatly appreciate the feedback.                         <br />                         <br />                         <a href=''https://www.research.net/s/healthfaircustomersurvey?id=@Model.CustomerId&eid=@Model.EventId&pod=@Model.PodName&edate=@Model.EventDate.ToString("M dd yyyy")''>                             https://www.research.net/s/healthfaircustomersurvey?id=@Model.CustomerId&eid=@Model.EventId&pod=@Model.PodName&edate=@Model.EventDate.ToString("M                             dd yyyy") </a>                     </td>                 </tr>                 <tr>                     <td style="font-size: 13px; width: 600px">                         To your health,                         <br />                         The @Model.EmailCommunicationBaseInfo.CompanyName Team                     </td>                 </tr>                 <tr>                     <td>                         <hr style="border: solid 1px #000000;" />                     </td>                 </tr>                 <tr>                     <td class="normaltxt_pw" style="font-size: 12px;">                         &copy; <a target="_blank" href="@Model.EmailCommunicationBaseInfo.PrivacyPolicyUrl">                             Privacy Policy</a> and <a target="_blank" href="@Model.EmailCommunicationBaseInfo.TermsConditionsUrl">                                 Terms of Service</a>                         <br />                         Reminder: @Model.EmailCommunicationBaseInfo.CompanyName will never ask for your                         password or creditcard number in an email.<br />                         <br />                         This email was sent by @Model.EmailCommunicationBaseInfo.CompanyName because you                         or someone on your behalf registered online at <a target="_blank" href="@Model.EmailCommunicationBaseInfo.SiteUrl">                             @Model.EmailCommunicationBaseInfo.SiteUrl.</a>                         <br />                         <br />                         <b>@Model.EmailCommunicationBaseInfo.CompanyName</b><br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.StreetAddressLine1<br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.StreetAddressLine2<br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.City, @Model.EmailCommunicationBaseInfo.CompanyAddress.State&nbsp;                         @Model.EmailCommunicationBaseInfo.CompanyAddress.ZipCode<br />                         <span style="color: Blue;">@Model.EmailCommunicationBaseInfo.PhoneTollFree</span> (Toll free)                         <br />                         <br />                         <b>THIS IS AN AUTOMATED MESSAGE</b> - PLEASE DO NOT REPLY DIRECTLY TO THIS EMAIL.                         IF YOU WISH TO CONTACT HEALTHFAIR VIA EMAIL PLEASE USE <a href="mailto:INFO@HEALTHFAIR.COM">                             INFO@HEALTHFAIR.COM</a>                     </td>                 </tr>             </table>         </td>     </tr> </table> '
	,getDate(),getDate())
	

--update TblEmailTemplate
--set EmailBody = '<table style="border-collapse: collapse; border-color: black;" border="1" cellpadding="0"     cellspacing="0" width="600">     <tr>         <td style="width: 600px; border: 1px">             <table style="font-family: Arial" border="0" cellpadding="10" cellspacing="0" width="600">                 <tr>                     <td style="height: 143px">                         <table border="0" cellpadding="10" cellspacing="0" width="600">                             <tr>                                 <td style="width: 250px">                                     <img src="@Model.EmailCommunicationBaseInfo.EmailNotificationLogoRelativePath" />                                 </td>                                 <td style="width: 350px" align="right">                                     Customer Service Questions                                 </td>                             </tr>                         </table>                     </td>                 </tr>                 <tr>                     <td>                         Dear <b>@Model.CustomerName.ToString()</b>,                     </td>                 </tr>                 <tr>                     <td style="font-size: 13px; width: 600px">                         Yesterday you made a great stride on the road to better health. @Model.EmailCommunicationBaseInfo.CompanyName                         is committed to providing you the best possible experience on our mobile health                         bus. In order for us to continue to perform above expectations, we ask that you                         complete a short survey. The survey should take no longer than 5 minutes of your                         time. We greatly appreciate the feedback.                         <br />                         <br />                         <a href=''https://www.research.net/s/healthfaircustomersurvey?id=@Model.CustomerId&eid=@Model.EventId&pod=@Model.PodName&edate=@Model.EventDate.ToString("M dd yyyy")''>                             https://www.research.net/s/healthfaircustomersurvey?id=@Model.CustomerId&eid=@Model.EventId&pod=@Model.PodName&edate=@Model.EventDate.ToString("M                             dd yyyy") </a>                     </td>                 </tr>                 <tr>                     <td style="font-size: 13px; width: 600px">                         To your health,                         <br />                         The @Model.EmailCommunicationBaseInfo.CompanyName Team                     </td>                 </tr>                 <tr>                     <td>                         <hr style="border: solid 1px #000000;" />                     </td>                 </tr>                 <tr>                     <td class="normaltxt_pw" style="font-size: 12px;">                         &copy; <a target="_blank" href="@Model.EmailCommunicationBaseInfo.PrivacyPolicyUrl">                             Privacy Policy</a> and <a target="_blank" href="@Model.EmailCommunicationBaseInfo.TermsConditionsUrl">                                 Terms of Service</a>                         <br />                         Reminder: @Model.EmailCommunicationBaseInfo.CompanyName will never ask for your                         password or creditcard number in an email.<br />                         <br />                         This email was sent by @Model.EmailCommunicationBaseInfo.CompanyName because you                         or someone on your behalf registered online at <a target="_blank" href="@Model.EmailCommunicationBaseInfo.SiteUrl">                             @Model.EmailCommunicationBaseInfo.SiteUrl.</a>                         <br />                         <br />                         <b>@Model.EmailCommunicationBaseInfo.CompanyName</b><br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.StreetAddressLine1<br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.StreetAddressLine2<br />                         @Model.EmailCommunicationBaseInfo.CompanyAddress.City, @Model.EmailCommunicationBaseInfo.CompanyAddress.State&nbsp;                         @Model.EmailCommunicationBaseInfo.CompanyAddress.ZipCode<br />                         <span style="color: Blue;">@Model.EmailCommunicationBaseInfo.PhoneTollFree</span> (Toll free)                         <br />                         <br />                         <b>THIS IS AN AUTOMATED MESSAGE</b> - PLEASE DO NOT REPLY DIRECTLY TO THIS EMAIL.                         IF YOU WISH TO CONTACT HEALTHFAIR VIA EMAIL PLEASE USE <a href="mailto:INFO@HEALTHFAIR.COM">                             INFO@HEALTHFAIR.COM</a>                     </td>                 </tr>             </table>         </td>     </tr> </table> '
--where EmailTitle = 'SurveyEmailNotification'