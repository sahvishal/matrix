
USE [$(dbName)]
Go

if not Exists (select EmailTemplateId from TblEmailTemplate where EmailTitle = 'UrgentCustomer')
begin
	INSERT INTO [TblEmailTemplate]
			   ([EmailTitle],[EmailSubject],[EmailBody],[DateCreated],[DateModified])
	VALUES
	('UrgentCustomer','Urgent Customer Notification' 
		,'<table style="border-color: black; width: 600px; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="0">  <tbody>  <tr>  <td style="vertical-align: top;">  <table style="width: 600px; font-family: Arial;" border="0" cellspacing="0" cellpadding="2">  <tbody>  <tr>  <td style="height: 100px;">  <table style="width: 600px;" border="0" cellspacing="0" cellpadding="2">  <tbody>  <tr>  <td style="width: 250px;"><img src="@Model.EmailCommunicationBaseInfo.EmailNotificationLogoRelativePath" alt="" /></td>  <td style="color: #5db3ed; width: 350px;" align="right">Urgent Customer &nbsp;</td>  </tr>  </tbody>  </table>  </td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px;">Hi,<br /> <br /> A patient has been marked as critical by Physician while evaluating results: <br /> <br /> <span style="text-decoration: underline;">The details of the Patient are</span>  <table style="border-color: black; font: 13px/normal Arial; border-collapse: collapse; font-size-adjust: none; font-stretch: normal;" cellspacing="0" cellpadding="0">  <tbody>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>PID :</strong> @Model.CustomerId</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Event Date :</strong> @Model.EventDate.ToString("MM/dd/yyyy")</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Event ID :</strong> @Model.EventId</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>POD :</strong> @Model.Pod</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Hospital Partner :</strong> @Model.HospitalPartner</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Partner Release :</strong> @Model.HospitalRelease</td>  </tr>  </tbody>  </table>  @if(Model.Tests !=null && Model.Tests.Count()>0)                                 {                                                                                          <br />                                <u>Urgent Test(s) Detail</u>                                     @foreach (var test in Model.Tests) {                                                                                          <br />                                <table cellpadding="0" cellspacing="0" border="0" style="border-collapse: collapse; font: 13px Arial; width:90%;">                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Test :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.TestName</td>                                    </tr>                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Physician :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.PhysicianName</td>                                    </tr>                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Physician Notes :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.PhysicianRemarks</td>                                    </tr>                                </table>                                <br />                                }                                 } <br /> - @Model.EmailCommunicationBaseInfo.CompanyName <span>Team</span></td>  </tr>  </tbody>  </table>  </td>  </tr>  </tbody>  </table>'
		,getDate(),getDate())

end
else
begin
	update TblEmailTemplate 
	set [EmailBody] = '<table style="border-color: black; width: 600px; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="0">  <tbody>  <tr>  <td style="vertical-align: top;">  <table style="width: 600px; font-family: Arial;" border="0" cellspacing="0" cellpadding="2">  <tbody>  <tr>  <td style="height: 100px;">  <table style="width: 600px;" border="0" cellspacing="0" cellpadding="2">  <tbody>  <tr>  <td style="width: 250px;"><img src="@Model.EmailCommunicationBaseInfo.EmailNotificationLogoRelativePath" alt="" /></td>  <td style="color: #5db3ed; width: 350px;" align="right">Urgent Customer &nbsp;</td>  </tr>  </tbody>  </table>  </td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px;">Hi,<br /> <br /> A patient has been marked as critical by Physician while evaluating results: <br /> <br /> <span style="text-decoration: underline;">The details of the Patient are</span>  <table style="border-color: black; font: 13px/normal Arial; border-collapse: collapse; font-size-adjust: none; font-stretch: normal;" cellspacing="0" cellpadding="0">  <tbody>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>PID :</strong> @Model.CustomerId</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Event Date :</strong> @Model.EventDate.ToString("MM/dd/yyyy")</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Event ID :</strong> @Model.EventId</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>POD :</strong> @Model.Pod</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Hospital Partner :</strong> @Model.HospitalPartner</td>  </tr>  <tr>  <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 100%;"><strong>Partner Release :</strong> @Model.HospitalRelease</td>  </tr>  </tbody>  </table>  @if(Model.Tests !=null && Model.Tests.Count()>0)                                 {                                                                                          <br />                                <u>Urgent Test(s) Detail</u>                                     @foreach (var test in Model.Tests) {                                                                                          <br />                                <table cellpadding="0" cellspacing="0" border="0" style="border-collapse: collapse; font: 13px Arial; width:90%;">                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Test :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.TestName</td>                                    </tr>                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Physician :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.PhysicianName</td>                                    </tr>                                    <tr>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 25%"><b>Physician Notes :</b></td>                                        <td class="normaltxt_pw" style="font-size: 13px; vertical-align: top; width: 75%">@test.PhysicianRemarks</td>                                    </tr>                                </table>                                <br />                                }                                 } <br /> - @Model.EmailCommunicationBaseInfo.CompanyName <span>Team</span></td>  </tr>  </tbody>  </table>  </td>  </tr>  </tbody>  </table>'
	where EmailTitle = 'UrgentCustomer'
end


	

	


